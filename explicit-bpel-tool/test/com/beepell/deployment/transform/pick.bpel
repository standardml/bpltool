<?xml version="1.0" encoding="ISO-8859-1"?>

<process
  name="proxy"
  targetNamespace="http://beepell.com/samples/proxy"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:srv="http://beepell.com/samples/proxy/definitions"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
   
   <import 
     namespace="http://beepell.com/samples/proxy/definitions" 
     location="./receive.wsdl" 
     importType="http://schemas.xmlsoap.org/wsdl/"  />   
   
   <partnerLinks>
      <partnerLink
        name="clientPartnerLink"
        partnerLinkType="srv:serviceProviderPartnerLinkType"
        myRole="serviceProviderRole" />

      <partnerLink
        name="serverPartnerLink"
        partnerLinkType="srv:serviceProviderPartnerLinkType"
        myRole="serviceProviderRole" />
        
   </partnerLinks>
   
   <variables>
      <variable name="idVariable" type="xsd:integer" />
      <variable name="descriptionVariable" element="xsd:string" />
      <variable name="approvedVariable" type="xsd:boolean" />
      <variable name="noteVariable" type="xsd:string" />       
      <variable name="addressVariable" element="srv:addressType" />       
      <variable name="request"  messageType="srv:requestMessage" />
      <variable name="response" messageType="srv:responseMessage" />
   </variables>

   <sequence>

      <!--- CORE PICK TEST -->
      <pick
        name="core"
        suppressJoinFailure="yes"
        createInstance="no">
        <targets>
          <joinCondition>
            fn:true()
          </joinCondition>
          <target linkName="ship-to-invoice" />
        </targets> 
        <sources> 
          <source linkName="ship-to-scheduling">
            <transitionCondition>
                fn:true()
            </transitionCondition>
          </source>
        </sources>  
        <onMessage
          partnerLink="serverPartnerLink"
          operation="requestService"
          messageExchange="mea"
          variable="request">
          <empty />
        </onMessage>
        <onAlarm>
          <for>'P3DT10H'</for>
          <empty />
        </onAlarm>
      </pick>

       
       <!-- FROM PARTS TESTS -->
       <pick
         name="fromparts"
         createInstance="no">
         <onMessage
           partnerLink="serverPartnerLink"
           operation="requestService"
           messageExchange="mec">
           <fromParts>
             <fromPart part="id" toVariable="idVariable" />
             <fromPart part="description" toVariable="descriptionVariable" />
           </fromParts>
           <empty />
         </onMessage>
       </pick>       

       <!-- ELEMENT VARIABLE MATCHING SINGLE PART TEST -->
       <pick
         name="elements"
         createInstance="no">
         <onMessage
	         partnerLink="serverPartnerLink"
	         operation="simpleService"
	         variable="addressVariable"
	         messageExchange="med">
           <empty />
         </onMessage>
       </pick>
 
        
        
      <reply
        partnerLink="proxyPartnerLink"
        operation="requestService"
        variable="response"/>
      
   </sequence>  
  
</process>
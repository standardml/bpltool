<?xml version="1.0" encoding="ISO-8859-1"?>

<process xmlns:three="urn:three"
  name="proxy"
  targetNamespace="http://beepell.com/samples/proxy"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:srv="http://beepell.com/samples/proxy/definitions"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
   
   <import namespace="http://beepell.com/samples/proxy/definitions" location="./test/com/beepell/deployment/transform/sef-invoke-test-case.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"  />   
   
   <partnerLinks>
      <partnerLink
        name="clientPartnerLink"
        partnerLinkType="srv:serviceProviderPartnerLinkType"
        myRole="serviceProviderRole" />

      <partnerLink
        name="serverPartnerLink"
        partnerLinkType="srv:serviceProviderPartnerLinkType"
        partnerRole="serviceProviderRole" />
        
   </partnerLinks>
   
   <variables>
      <variable name="idVariable" type="xsd:integer" />
      <variable name="descriptionVariable" element="xsd:string" />
      <variable name="approvedVariable" type="xsd:boolean" />
      <variable name="noteVariable" type="xsd:string" />       
      <variable name="addressVariable" element="srv:addressType" />       
      <variable name="request"  messageType="srv:requestMessage" />
      <variable name="response" messageType="srv:responseMessage" />
   </variables>

   <sequence>

      <receive
        partnerLink="proxyPartnerLink"
        operation="requestService"
        variable="request"
        createInstance="yes"/>


      <!--- CORE INVOKE TEST -->
      <invoke xmlns:one="urn:foo" xmlns:two="urn:bar"
        name="core"
        suppressJoinFailure="yes"
        partnerLink="serverPartnerLink"
        operation="requestService"
        inputVariable="request"
        outputVariable="response">
        <targets>
          <joinCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
            fn:true()
          </joinCondition>
          <target linkName="ship-to-invoice" />
        </targets> 
        <sources> 
          <source xmlns:one="urn:one" xmlns:two="urn:two" linkName="ship-to-scheduling">
            <transitionCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                true()
            </transitionCondition>
          </source>
        </sources>    
        <correlations>
          <correlation set="PurchaseOrder" pattern="request" />
        </correlations> 
      </invoke>


      <!-- IMPLICIT SCOP TEST -->
      <!-- Note: this is valid BPEL as we are using links that are not defined, but it is suitable for testing -->  
      <invoke
        name="localscope"
        suppressJoinFailure="yes"
        partnerLink="serverPartnerLink"
        operation="requestService"
        inputVariable="request"
        outputVariable="response">
        <targets>
          <joinCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
            fn:true()
          </joinCondition>
          <target linkName="ship-to-invoice" />
        </targets> 
        <sources> 
          <source linkName="ship-to-scheduling">
            <transitionCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                fn:true()
            </transitionCondition>
          </source>
        </sources> 
        <correlations>
          <correlation set="PurchaseOrder" pattern="request" />
        </correlations> 
        <catch faultName="bpel:correlationViolation">
          <empty name="catch"/> 
        </catch> 
        <catchAll>
          <empty name="catchAll"/> 
        </catchAll> 
        <compensationHandler>
          <empty name="compensationHandler"/> 
        </compensationHandler> 
      </invoke>

       
       
       <!-- TO / FROM PARTS TESTS -->
       <invoke
         name="tofromparts"
         partnerLink="serverPartnerLink"
         operation="requestService">
         <toParts>
           <toPart part="id" fromVariable="idVariable" />
           <toPart part="description" fromVariable="descriptionVariable" />
         </toParts>
         <fromParts>
           <fromPart part="approved" toVariable="approvedVariable" />
           <fromPart part="note" toVariable="noteVariable" />
         </fromParts>
       </invoke>       

       <invoke
         name="toparts"
         partnerLink="serverPartnerLink"
         operation="requestService"
         outputVariable="response">
         <toParts>
           <toPart part="id" fromVariable="idVariable" />
           <toPart part="description" fromVariable="descriptionVariable" />
         </toParts>
       </invoke>            

       <invoke
         name="fromparts"
         partnerLink="serverPartnerLink"
         operation="requestService"
         inputVariable="request">
         <fromParts>
           <fromPart part="approved" toVariable="approvedVariable" />
           <fromPart part="note" toVariable="noteVariable" />
         </fromParts>
       </invoke>            



       <!-- ELEMENT VARIABLE MATCHING SINGLE PART TEST -->
       <invoke
        name="elements"
        partnerLink="serverPartnerLink"
        operation="simpleService"
        inputVariable="addressVariable"
        outputVariable="addressVariable"/>
        
        
        
        
        
      <!-- MIXED INVOKE TEST -->
      <!-- Note: this is valid BPEL  -->  
      <invoke
        name="mixed"
        partnerLink="serverPartnerLink"
        operation="requestService"
        outputVariable="addressVariable"
        suppressJoinFailure="yes">
        <targets>
          <joinCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
            fn:true()
          </joinCondition>
          <target linkName="ship-to-invoice" />
        </targets> 
        <sources> 
          <source linkName="ship-to-scheduling">
            <transitionCondition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                fn:true()
            </transitionCondition>
          </source>
        </sources> 
        <correlations>
          <correlation set="PurchaseOrder" pattern="request" />
        </correlations>    
        <catch faultName="bpel:correlationViolation">
          <empty name="catch"/> 
        </catch> 
        <catchAll>
          <empty name="catchAll"/> 
        </catchAll> 
        <compensationHandler>
          <empty name="compensationHandler"/> 
        </compensationHandler>
        <toParts>
          <toPart part="id" fromVariable="idVariable" />
          <toPart part="description" fromVariable="descriptionVariable" />
        </toParts>
      </invoke>
        
        
        
      <reply
        partnerLink="proxyPartnerLink"
        operation="requestService"
        variable="response"/>
      
   </sequence>  
  
</process>
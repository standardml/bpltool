<?xml version="1.0" encoding="ISO-8859-1"?>

<process
  name="invokable"
  targetNamespace="http://beepell.com/test/"
  xmlns:inv="http://beepell.com/samples/invokable/definitions"
  xmlns:flt="http://beepell.com/samples/invokable/schema"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:srv="http://beepell.com/samples/proxy/definitions"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">

  <import importType="http://schemas.xmlsoap.org/wsdl/" namespace="http://beepell.com/samples/invokable/definitions" location="invokable-service.wsdl" />   
  <import importType="http://schemas.xmlsoap.org/wsdl/" namespace="http://beepell.com/samples/proxy/definitions"  location="invokable-process.wsdl" />   
  
  <partnerLinks>
    <partnerLink
      name="echoPartnerLink"
      partnerLinkType="srv:echoPartnerLinkType"
      myRole="echoProviderRole" />
    <partnerLink
      name="invokablePartnerLink"
      partnerLinkType="inv:invokablePartnerLinkType"
      partnerRole="invokableProviderRole"
      initializePartnerRole="yes" />    
  </partnerLinks>
  
  <variables>
    <variable name="request" messageType="srv:echoMessage" />
    <variable name="invokableRequest" messageType="inv:invokeMessage" />
    <variable name="invokableResponse" messageType="inv:invokeMessage" />
    <variable name="faultVariableC" messageType="flt:faultMessageC" />
  </variables>
  
  <faultHandlers>
    <catch faultName="inv:firstFault">
      <sequence>
        <assign>
          <copy>
            <from>string('first')</from>
            <to variable="request" part="text" />
          </copy>
        </assign>
        <reply
          partnerLink="echoPartnerLink"
          operation="echoOperation"
          variable="request"/>
      </sequence>
    </catch>
    <catch faultName="inv:secondFault">
      <sequence>
        <assign>
          <copy>
            <from>string('second')</from>
            <to variable="request" part="text" />
          </copy>
        </assign>
        <reply
          partnerLink="echoPartnerLink"
          operation="echoOperation"
          variable="request"/>
      </sequence>     
    </catch>
    <catch faultVariable="faultVariableC" faultMessageType="inv:faultMessageC">
      <sequence>
        <assign>
          <copy>
            <from>string('third')</from>
            <to variable="request" part="text" />
          </copy>
        </assign>
        <reply
          partnerLink="echoPartnerLink"
          operation="echoOperation"
          variable="request"/>
      </sequence>
    </catch>
    <catch faultName="inv:fourthFault">
      <sequence>
        <assign>
          <copy>
            <from>string('fourth')</from>
            <to variable="request" part="text" />
          </copy>
        </assign>
        <reply
          partnerLink="echoPartnerLink"
          operation="echoOperation"
          variable="request"/>
      </sequence>   
    </catch>
    <catchAll>
      <reply
        partnerLink="echoPartnerLink"
        operation="echoOperation"
        variable="request"/>
   </catchAll>
  </faultHandlers>
  
  <sequence>
    
    <receive
      partnerLink="echoPartnerLink"
      operation="echoOperation"
      variable="request"
      createInstance="yes"/>

    <assign>
      <copy>
        <from>$request.text</from>
        <to variable="invokableRequest" part="number" />
      </copy>
    </assign>

    <invoke
      partnerLink="invokablePartnerLink"
      operation="faultOperation"
      inputVariable="invokableRequest"
      outputVariable="invokableResponse"/>

    <assign>
      <copy>
        <from>string('FAILED')</from>
        <to variable="request" part="text" />
      </copy>
    </assign>
    
    <reply
      partnerLink="echoPartnerLink"
      operation="echoOperation"
      variable="request"/>
    
  </sequence>  
  
</process>
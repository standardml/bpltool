<?xml version="1.0" encoding="ISO-8859-1"?>

<process
  name="receive2"
  targetNamespace="http://beepell.com/samples/proxy"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:srv="http://beepell.com/samples/echo/definitions"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">

  <import
    namespace="http://beepell.com/samples/echo/definitions"
    location="./receive2.wsdl"
    importType="http://schemas.xmlsoap.org/wsdl/" />

  <partnerLinks>
    <partnerLink
      name="echoPartnerLink"
      partnerLinkType="srv:echoPartnerLinkType"
      myRole="echoServiceProvider" />
  </partnerLinks>
  
  <messageExchanges>
    <messageExchange name="main" />
  </messageExchanges>

  <variables>
    <variable
      name="requestMessage"
      messageType="srv:echoMessage" />
    <variable
      name="responseMessage"
      messageType="srv:ecohMessage" />
  </variables>

  <flow>
    <links>
      <link name="link1" />
      <link name="link2" />
    </links>

    <receive name="receive"
      partnerLink="echoPartnerLink"
      operation="echoOperation"
      createInstance="yes"
      variable="requestMessage"
      messageExchange="main">
      <sources>
        <source linkName="link1" />
      </sources>
      <correlations>
        <correlation 
           set="order-invoice" 
           initiate="yes" />
      </correlations>
    </receive>

    <assign>
      <targets>
        <target linkName="link1" />
      </targets>
      <sources>
        <source linkName="link2" />
      </sources>
      <copy>
        <bpel:from variable="requestMessage" />
        <bpel:to variable="responseMessage" />
      </copy>
    </assign>

    <reply
      partnerLink="echoPartnerLink"
      operation="echoOperation"
      variable="responseMessage" 
      messageExchange="main">
      <targets>
        <target linkName="link2" />
      </targets>      
    </reply>

  </flow>
</process>
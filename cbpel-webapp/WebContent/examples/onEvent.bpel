<?xml version="1.0" encoding="ISO-8859-1"?>

<process
  name="proxy"
  targetNamespace="http://beepell.com/samples/proxy"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:srv="http://beepell.com/samples/proxy/definitions"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
   
  <import 
    namespace="http://beepell.com/samples/proxy/definitions" 
    location="./onEvent.wsdl" 
    importType="http://schemas.xmlsoap.org/wsdl/"  />   
   
  <partnerLinks>
    <partnerLink
      name="clientPartnerLink"
      partnerLinkType="srv:serviceProviderPartnerLinkType"
      myRole="serviceProviderRole" />
  </partnerLinks>

  <variables>
    <variable name="request"  messageType="srv:requestMessage" />
    <variable name="response" messageType="srv:responseMessage" />
  </variables>
   
  <eventHandlers>
    <!-- CORE TESTS -->
    <onEvent
      partnerLink="eventPartnerLink"
      operation="requestService"
      messageType="srv:requestMessage"
      variable="request">
      <scope>
        <partnerLinks>
          <partnerLink
            name="eventPartnerLink"
            partnerLinkType="srv:serviceProviderPartnerLinkType"
            myRole="serviceProviderRole" />
        </partnerLinks>
        <empty name="emptyCore" />
      </scope>
    </onEvent>
    
    <!-- FROM PARTS TESTS -->
    <onEvent
      partnerLink="eventPartnerLink"
      operation="requestService">
      <fromParts>
        <fromPart part="id" toVariable="idVariable" />
        <fromPart part="description" toVariable="descriptionVariable" />
      </fromParts>
      <scope>
        <partnerLinks>
          <partnerLink
            name="eventPartnerLink"
            partnerLinkType="srv:serviceProviderPartnerLinkType"
            myRole="serviceProviderRole" />
        </partnerLinks>
        <empty name="emptyFromParts" />
      </scope>
    </onEvent>
    
    <!-- ELEMENT VARIABLE MATCHING SINGLE PART TEST -->
    <onEvent
      partnerLink="eventPartnerLink"
      operation="simpleService"
      element="srv:addressType"
      variable="addressVariable">
      <scope>
        <partnerLinks>
          <partnerLink
            name="eventPartnerLink"
            partnerLinkType="srv:serviceProviderPartnerLinkType"
            myRole="serviceProviderRole" />
        </partnerLinks>
        <empty name="emptyElements" />
      </scope>
    </onEvent>
  </eventHandlers>

  <sequence>
    <receive
      partnerLink="clientPartnerLink"
      operation="requestService"
      createInstance="yes"
      messageExchange="mea"
      variable="request" />
    <reply
      partnerLink="clientPartnerLink"
      operation="requestService"
      variable="response"/>
  </sequence>  
  
</process>
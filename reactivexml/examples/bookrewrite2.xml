<REWRITE_RULESET NAME="BookRoom"
   CONSTRAINT="descendant-or-self::*[room and not(room/booked)]">
<!--[not(child::*[name()='booked'])]">-->

  <REWRITE_RULE NAME="BOOK">

     <RULE_LEFT>
        <room p1="$room">
           <person p1="$person"/>
           <RULE_HOLE NAME="MORE_PERSONS"/>
        </room>
     </RULE_LEFT>

     <RULE_RIGHT>
        <room p1="$room">
           <person p1="$person"/>
	   <booked p1="$person"/>
           <RULE_HOLE NAME="MORE_PERSONS"/>
        </room>
     </RULE_RIGHT>

  </REWRITE_RULE>

</REWRITE_RULESET>